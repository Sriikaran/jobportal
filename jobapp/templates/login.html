{% extends "parent.html" %}
{% load static %}
{% block body %}
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
  .login-page { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
  .login-page .main-content { min-height: 65vh; display:flex; align-items:center; justify-content:center; padding: 2rem 1rem; }
  .login-page .login-container { width:100%; max-width: 420px; }
  .login-page .login-card { background: rgba(255,255,255,0.95); backdrop-filter: blur(20px); border-radius: 24px; padding: 2.5rem 2rem 2rem; box-shadow:0 8px 32px rgba(9,63,117,0.12); border:1px solid rgba(255,255,255,0.2); position:relative; }
  .login-page .login-header { text-align:center; margin-bottom: 1.2rem; }
  .login-page .login-floating-logo { position:absolute; left:50%; top:-44px; transform:translateX(-50%); width:88px; height:88px; background:transparent; border-radius:50%; box-shadow:0 4px 16px rgba(9,63,117,0.13); display:flex; align-items:center; justify-content:center; z-index:2; }
  .login-page .login-title { font-size:1.25rem; font-weight:600; color:#093f75; margin-bottom: .2rem; letter-spacing:.5px; }
  .login-page .login-subtitle { color:#666; font-weight:500; }
  .login-page .form-group { margin-bottom: 1.5rem; }
  .login-page .form-label { display:block; font-weight:600; color:#093f75; margin-bottom:.5rem; font-size:.95rem; }
  .login-page .input-wrapper { position:relative; }
  .login-page .input-icon { position:absolute; left:12px; top:50%; transform:translateY(-50%); color:#666; font-size:1.1rem; }
  .login-page .form-input, .login-page .form-select { width:100%; padding:12px 12px 12px 45px; border:2px solid #e8f2ff; border-radius:12px; background:#f8fbff; font-size:.95rem; transition: box-shadow .25s, border-color .25s; }
  .login-page .form-select { padding-left:16px; background:#f8fbff; box-shadow:none; cursor:pointer; }
  .login-page .form-input:focus, .login-page .form-select:focus { outline:none; border-color:#093f75; background:#fff; box-shadow:0 4px 16px rgba(9,63,117,0.10); }
  .login-page .password-toggle { position:absolute; right:12px; top:50%; transform:translateY(-50%); background:none; border:none; color:#666; cursor:pointer; }
  .login-page .form-links { display:flex; justify-content:space-between; margin:.5rem 0 1rem; }
  .login-page .form-links a { color:#093f75; text-decoration:none; font-weight:600; }
  .login-page .form-links a:hover { text-decoration:underline; }
  .login-page .checkbox-wrapper { display:flex; align-items:center; gap:.5rem; color:#555; margin-bottom:.5rem; }
  .login-page .btn { display:inline-flex; align-items:center; gap:.5rem; padding:10px 16px; background:#fff; border:1px solid #dadce0; border-radius:8px; font-size:15px; font-weight:500; color:#093f75; cursor:pointer; box-shadow:0 1px 2px rgba(0,0,0,0.05); transition: box-shadow .2s, background-color .2s; }
  .login-page .btn:hover { box-shadow:0 2px 4px rgba(0,0,0,0.1); background-color:#f8f9fa; }
  .login-page .btn-primary { background:linear-gradient(135deg,#0b6fbf,#0c3056); color:#fff; border:none; }
  .login-page .divider { text-align:center; color:#666; }
  .login-page .btn-google { color:#4285F4; }
  .login-page .google-icon { width:20px; height:20px; vertical-align:middle; }
  .login-page .btn-linkedin { color:#0077B5; }
  .login-page .linkedin-icon { width:20px; height:20px; display:inline-block; }
  .login-page .modal-overlay { position: fixed; inset: 0; background: rgba(0, 0, 0, 0.45); display: none; align-items: center; justify-content: center; z-index: 2000; }
  .login-page .modal-overlay.active { display: flex; }
  .login-page .modal-box { background: #fff; padding: 1.5rem; border-radius: 14px; width: min(520px, 92vw); box-shadow: 0 10px 30px rgba(0,0,0,0.15); position: relative; }
  .login-page .modal-title { font-weight: 700; color: #093f75; font-size: 1.1rem; margin-bottom: .75rem; }
  .login-page .modal-close { position: absolute; top: 8px; right: 10px; background: none; border: none; font-size: 1.5rem; cursor: pointer; color:#666; }
</style>
<div class="login-page">
  <main class="main-content">
    <div class="login-container">
      <div class="login-card">
        <div class="login-floating-logo"><img src="{% static 'images/logo.png' %}" alt="Dream Jobs" style="width:88px; height:88px; border-radius:50%; object-fit:contain; background:#fff; box-shadow:0 2px 8px rgba(9,63,117,0.10); display:block;"></div>
        <div class="login-header" style="margin-top: 36px;">
          <h1 class="login-title" style="margin-bottom:0.2rem;">Welcome to Dream Jobs</h1>
          <p class="login-subtitle" style="margin-bottom:0.5rem;">Access your account below</p>
        </div>
        {% if messages %}{% for message in messages %}<div class="alert alert-warning">{{ message }}</div>{% endfor %}{% endif %}
        {% if msg %}<p style="color:red; font-weight:bold; text-align:center;">{{ msg }}</p>{% endif %}
        <form id="login-form" method="POST" action="{% url 'jobapp:login' %}" autocomplete="off">{% csrf_token %}
          <div class="form-group"><label class="form-label" for="usertype">Login as</label><select class="form-select" name="usertype" id="usertype" required><option value="" disabled selected>Select your role</option><option value="jobseeker">Job Seeker</option><option value="employer">Employer</option><option value="administrator">Administrator</option></select></div>
          <div class="form-group"><label class="form-label" for="username">Email</label><div class="input-wrapper"><i class="fas fa-envelope input-icon"></i><input type="email" class="form-input" name="username" id="username" placeholder="Enter your email" required></div></div>
          <div class="form-group"><label class="form-label" for="password">Password</label><div class="input-wrapper"><i class="fas fa-lock input-icon"></i><input type="password" class="form-input" name="password" id="password" placeholder="Enter your password" minlength="6" required><button type="button" class="password-toggle" onclick="togglePassword()"><i class="fas fa-eye" id="eyeIcon"></i></button></div></div>
          <div class="form-links"><a href="#">Forgot password?</a><a href="{% url 'jobapp:jobseekerreg' %}">Register Here</a></div>
          <div class="checkbox-wrapper"><input type="checkbox" id="terms" name="terms" required><label for="terms">I agree to the <a href="#" id="show-terms-link">Terms of Service</a></label></div>
          <div class="text-center" style="display:flex; justify-content:center; align-items:center; padding-top:12px;"><button type="submit" class="btn btn-primary"><i class="fas fa-sign-in-alt"></i> Sign In</button></div>
          <div class="divider" style="padding-top:12px; padding-bottom:6px"><span style="display:inline-block; margin-top:10px;">Or sign in with</span></div>
          <div class="text-center" style="display:flex; justify-content:center; gap:10px; flex-direction:column; align-items:center;">
            <button type="button" class="btn btn-google" onclick="handleGoogleLogin()"><svg class="google-icon" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg> Continue with Google</button>
            <button type="button" class="btn btn-linkedin" onclick="handleLinkedInLogin()"><svg class="linkedin-icon" viewBox="0 0 24 24"><path fill="#0077B5" d="M20.45 20.45h-3.55v-5.4c0-1.29-.03-2.95-1.8-2.95-1.8 0-2.08 1.4-2.08 2.85v5.5H9.48V9h3.4v1.56h.05c.47-.89 1.6-1.83 3.3-1.83 3.53 0 4.18 2.32 4.18 5.33v6.39zM5.34 7.43c-1.14 0-2.06-.93-2.06-2.06 0-1.14.92-2.06 2.06-2.06s2.06.92 2.06 2.06c0 1.13-.92 2.06-2.06 2.06zM7.12 20.45H3.56V9h3.56v11.45zM22.23 0H1.77C.79 0 0 .77 0 1.72v20.56C0 23.23.79 24 1.77 24h20.45c.98 0 1.78-.77 1.78-1.72V1.72C24 .77 23.21 0 22.23 0z"/></svg> Continue with LinkedIn</button>
          </div>
        </form>
      </div>
    </div>
  </main>
  <div class="modal-overlay" id="terms-modal"><div class="modal-box"><button class="modal-close" id="close-terms-modal" aria-label="Close">&times;</button><div class="modal-title">Terms of Service</div><div class="modal-content"><ul style="padding-left: 1.2em;"><li>You must be at least 18 years old to use Dream Jobs.</li><li>All information provided must be accurate and up to date.</li><li>Do not share your account credentials with others.</li><li>Dream Jobs is not responsible for third-party content or job listings.</li><li>Any misuse of the platform may result in account suspension.</li><li>Respect all users and employers on the platform.</li><li>By using Dream Jobs, you agree to receive occasional emails and notifications.</li><li>These terms may be updated at any time without prior notice.</li></ul><p style="margin-top:1em; color:#888; font-size:0.93em;">For more details, contact our support team.</p></div></div></div>
</div>
<script>
  (function(){const termsModal=document.getElementById('terms-modal');const showTermsLink=document.getElementById('show-terms-link');const closeTermsModal=document.getElementById('close-terms-modal');if(showTermsLink&&termsModal&&closeTermsModal){showTermsLink.addEventListener('click',function(e){e.preventDefault();termsModal.classList.add('active');});closeTermsModal.addEventListener('click',function(){termsModal.classList.remove('active');});termsModal.addEventListener('click',function(e){if(e.target===termsModal)termsModal.classList.remove('active');});}})();
  function togglePassword(){const p=document.getElementById('password');const eye=document.getElementById('eyeIcon');if(p.type==='password'){p.type='text';eye.classList.replace('fa-eye','fa-eye-slash');}else{p.type='password';eye.classList.replace('fa-eye-slash','fa-eye');}}
  function handleGoogleLogin(){console.log('Google login initiated');}
  function handleLinkedInLogin(){console.log('LinkedIn login initiated');}
  const loginForm=document.getElementById('login-form');if(loginForm){loginForm.addEventListener('submit',function(e){const usertype=document.getElementById('usertype').value;const username=document.getElementById('username').value.trim();const password=document.getElementById('password').value;const terms=document.getElementById('terms').checked;const emailPattern=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;if(!usertype||!username||!password||!terms){e.preventDefault();alert('Please fill in all required fields and accept the terms.');return;}if(!emailPattern.test(username)){e.preventDefault();alert('Please enter a valid email address.');return;}if(password.length<6){e.preventDefault();alert('Password must be at least 6 characters long.');return;}});} 
</script>
{% endblock %}

    <!-- Footer matching parent template -->
    <footer style="position: relative">
      <div class="container">
        <p class="mb-0">
          &copy; 2024 Dream Jobs. All rights reserved. Developed by&nbsp;
          <a href="#" target="_blank" rel="noopener noreferrer">Khushi Nigam</a>
        </p>
      </div>
    </footer>

    <!-- Enhanced JavaScript -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Navbar scroll effect
        const navbar = document.getElementById("mainNavbar");
        if (navbar) {
          window.addEventListener("scroll", function () {
            navbar.classList.toggle("scrolled", window.scrollY > 50);
          });
        }

        // Focus animations for inputs
        const inputs = document.querySelectorAll(".form-input, .form-select");
        inputs.forEach((input) => {
          input.addEventListener("focus", function () {
            this.closest(".form-group").classList.add("focused");
          });
          input.addEventListener("blur", function () {
            this.closest(".form-group").classList.remove("focused");
          });
          input.addEventListener("input", function () {
            this.classList.toggle("has-content", this.value.length > 0);
          });
        });

        // Auto-hide alerts after 5s
        document.querySelectorAll(".alert").forEach((alert) => {
          setTimeout(() => {
            alert.style.opacity = "0";
            alert.style.transform = "translateY(-10px)";
            setTimeout(() => alert.remove(), 300);
          }, 5000);
        });
      });

      // Store selected role instead of redirecting instantly
      let selectedRole = "";
      document
        .getElementById("usertype")
        .addEventListener("change", function () {
          selectedRole = this.value;
        });

      // Form submit validation + role-based redirect
      document.querySelector("form").addEventListener("submit", function (e) {
        const usertype = document.getElementById("usertype").value;
        const username = document.getElementById("username").value.trim();
        const password = document.getElementById("password").value;
        const terms = document.getElementById("terms").checked;
        const submitBtn = e.target.querySelector('button[type="submit"]');
        const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

        // Validation
        if (!usertype) {
          e.preventDefault();
          showFieldError("usertype", "Please select your role");
          return;
        }
        if (!username || !emailPattern.test(username)) {
          e.preventDefault();
          showFieldError("username", "Please enter a valid email address");
          return;
        }
        if (!password || password.length < 6) {
          e.preventDefault();
          showFieldError(
            "password",
            "Password must be at least 6 characters long"
          );
          return;
        }
        if (!terms) {
          e.preventDefault();
          alert("Please accept the Terms of Service to continue");
          return;
        }

        // Loading state
        submitBtn.innerHTML =
          '<i class="fas fa-spinner fa-spin"></i> Signing In...';
        submitBtn.disabled = true;

        // Redirect based on selected role
        if (selectedRole === "jobseeker") {
          this.action = "{% url 'jsapp:jshome' %}";
        } else if (selectedRole === "employer") {
          this.action = "{% url 'employer:employerhome' %}";
        } else if (selectedRole === "administrator") {
          this.action = "{% url 'adminapp:adminhome' %}";
        }
      });

      // Show field error helper
      function showFieldError(fieldId, message) {
        const field = document.getElementById(fieldId);
        const wrapper = field.closest(".input-wrapper") || field.parentElement;

        // Remove old error
        wrapper.querySelectorAll(".field-error").forEach((el) => el.remove());

        // Error styling
        field.style.borderColor = "#dc3545";
        field.style.boxShadow = "0 0 0 0.2rem rgba(220, 53, 69, 0.25)";

        // Error message
        const errorDiv = document.createElement("div");
        errorDiv.className = "field-error";
        errorDiv.style.cssText =
          "color: #dc3545; font-size: 0.875rem; margin-top: 0.25rem; display: flex; align-items: center;";
        errorDiv.innerHTML = `<i class="fas fa-exclamation-circle me-1"></i>${message}`;
        wrapper.appendChild(errorDiv);

        field.focus();
      }

// Improved password visibility toggle
function togglePassword() {
  const passwordInput = document.getElementById("password");
  const eyeIcon = document.getElementById("eyeIcon");
  if (!passwordInput || !eyeIcon) return; // safety check

  const isHidden = passwordInput.type === "password";
  passwordInput.type = isHidden ? "text" : "password";

  // Toggle eye icon class
  eyeIcon.classList.toggle("fa-eye", !isHidden);
  eyeIcon.classList.toggle("fa-eye-slash", isHidden);

  // Accessibility update
  const toggleBtn = document.getElementById("togglePassword");
  if (toggleBtn) {
    toggleBtn.setAttribute("aria-label", isHidden ? "Hide password" : "Show password");
  }

  // UX: keep caret at end
  const valueLength = passwordInput.value.length;
  passwordInput.focus();
  try {
    passwordInput.setSelectionRange(valueLength, valueLength);
  } catch (e) {}
}
    </script>
  </body>
</html>

